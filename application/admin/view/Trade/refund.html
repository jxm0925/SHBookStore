<!DOCTYPE html>
<html lang="en">
   <head>
      <!-- BEGIN META --> 
    <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="description" content="">
      <meta name="author" content="Custom Theme">
    <!-- END META -->
     
      <!-- BEGIN SHORTCUT ICON -->
    <link rel="shortcut icon" href="img/favicon.ico">
    <!-- END SHORTCUT ICON -->
      <title>role</title>
    
    <!-- BEGIN STYLESHEET --> 
      <link href="__ADMIN_CSS__/bootstrap.min.css" rel="stylesheet"><!-- BOOTSTRAP CSS -->
      <link href="__ADMIN_CSS__/bootstrap-reset.css" rel="stylesheet"><!-- BOOTSTRAP CSS -->
      <link href="__ASSETS__/font-awesome/css/font-awesome.css" rel="stylesheet"><!-- FONT AWESOME ICON STYLESHEET -->
      <link rel="stylesheet" href="__ASSETS__/data-tables/DT_bootstrap.css"><!-- DATATABLE CSS -->
      <link href="__ADMIN_CSS__/style.css" rel="stylesheet"><!-- THEME BASIC CSS -->
      <link href="__ADMIN_CSS__/style-responsive.css" rel="stylesheet"><!-- THEME BASIC RESPONSIVE  CSS -->
      <!--[if lt IE 9]>
      <script src="__ADMIN_JS__/html5shiv.js"></script>
      <script src="__ADMIN_JS__/respond.min.js"></script>
      <![endif]-->
    <!-- END STYLESHEET --> 
   </head>
   <body>
   <!-- BEGIN SECTION --> 
         <!-- BEGIN SECTION -->
    {include file="common/admin/head.html"}
    <!-- END HEADER NAV -->

      {include file="common/admin/left.html"}
      <!-- END SIDEBAR --> 
     
     <!-- BEGIN MAIN CONTENT --> 
         <section id="main-content">
        <!-- BEGIN WRAPPER  -->
            <section class="wrapper site-min-height">
               <section class="panel">
                  <header class="panel-heading">
                     <span class="label label-primary">退款管理</span>
                     <span class="tools pull-right">
                     <a href="javascript:;" class="fa fa-chevron-down"></a>                     
                     </span>
                  </header>
                  <div class="panel-body">
                     <div class="adv-table editable-table ">
                        <div class="clearfix">
                        <div class="border clearfix">
                         <span class="l_f">
                            <a href="javascript:ovid()" class="btn btn-success Order_form"><i class="fa fa-check-square-o"></i>&nbsp;已退款订单</a>
                            <a href="javascript:ovid()" class="btn btn-warning Order_form"><i class="fa fa-close"></i>&nbsp;未退款订单</a>
                            <a href="javascript:ovid()" class="btn btn-danger"><i class="fa fa-trash"></i>&nbsp;批量删除</a>
                           </span>
                           <span class="r_f">共：<b>{if!empty($count)}{$count}{/if}</b>笔</span>
                       </div>
                          
                        </div>
                        <br>
                        <div class="btn-group" role="group"> 
                          <a class="btn btn-default" onClick="select()">全选</a> 
                          <a class="btn btn-default" onClick="reverse()">反选</a> 
                          <a class="btn btn-default" onClick="noselect()">不选</a>
                        </div>
                        <div class="space15"></div>
                          <table class="table table-bordered">
                            <caption>退款列表</caption>
                            <thead>
                              <tr>
                                <th></th>
                                <th>订单号</th>
                                <th>产品名</th>
                                <th>交易金额</th>
                                <th>交易时间</th>
                                <th>退款时间</th>
                                <th>状态</th>
                                <th>说明</th>
                                <th>操作</th>
                              </tr>
                            </thead>
                            <tbody>
                            {if!empty($data)}
                            {foreach $data as $key=>$value}
                              <tr>
                                <td><input type="checkbox" name="checkbox[]"></td>
                                <td class="order_num">{$key}</td>
                                <td>
                                {foreach $value as $v}
                                  {$v['good_name']}+
                                {/foreach}
                                </td>
                                <td>{$v['totalmoney']}</td>
                                <td>{:date('Y-m-d',$v['create_time'])}</td>
                                <td>{:date('Y-m-d',$v['refund_time'])}</td>
                                {if $v['refund_status'] == 0}
                                <td class="td-status">
                                  未退款
                                </td>
                                {else}
                                <td class="td-status">
                                  已退款
                                </td>
                                {/if}
                                <td>{$v['refund_details']}</td>
                                <td>
                                  <input type="hidden" class="hiddenId" value="">
                                  {if($v['refund_status']==0)}
                                   <button class="btn btn-xs btn-success reMoney">退款</button> 
                                   {/if}
                                   <button class="btn btn-xs btn-info refund_detaile"><a href="refund_detaile?userid={$v['user_id']}&refund_id={$v['refund_id']}&order_num={$key}">详细</a></button> 
                                   <button class="btn btn-xs btn-warning del">删除</button>    
                               </td>
                              </tr>
                              {/foreach}   
                              {/if} 
                            </tbody>
                          </table>
                     </div>
                  </div>
               </section>
            </section>
         </section>
      </section>
<!-- BEGIN JS -->     
    <script type="text/javascript" src="__ADMIN_JS__/table_choose.js"></script><!--全选-->
    <script src="__ADMIN_JS__/jquery-1.8.3.min.js" ></script><!-- BASIC JS LIABRARY 1.8.3 -->
    <script src="__ADMIN_JS__/bootstrap.min.js" ></script><!-- BOOTSTRAP JS  -->
    <script src="__ADMIN_JS__/jquery.dcjqaccordion.2.7.js"></script><!-- ACCORDING JS -->
    <script src="__ADMIN_JS__/jquery.scrollTo.min.js" ></script><!-- SCROLLTO JS  -->
    <script src="__ADMIN_JS__/jquery.nicescroll.js" > </script><!-- NICESCROLL JS  -->
    <script src="__ASSETS__/data-tables/jquery.dataTables.js"></script><!-- DATATABLE JS  -->
    <script src="__ASSETS__/data-tables/DT_bootstrap.js"></script><!-- DATATABLE JS  -->
    <script src="__ADMIN_JS__/respond.min.js" ></script><!-- RESPOND JS  -->
    <script src="__ADMIN_JS__/common-scripts.js" ></script><!-- BASIC COMMON JS  -->
    <script src="__ADMIN_JS__/editable-table.js" ></script><!-- EDITABLE TABLE JS  -->
    <script src="__ASSETS__/layer/layer.js" type="text/javascript" ></script>
    <script src="__ASSETS__/laydate/laydate.js" type="text/javascript"></script>
    <!-- END JS --> 
   </body>
</html>
<script>
//退款按钮事件
      $('.reMoney').click(function(){
        var order_num = $('.order_num').text();
        console.log(order_num);
        var obj = $(this);
          layer.confirm('确定退款吗', {
          btn: ['确定','取消'] //按钮
          }, function(){
            $.ajax({
                type: "post",
                url:"changeRefundStatus",
                data: {order_num:order_num},
                dataType: "json",
                success: function(data) {
                  if (data == 1) {
                    obj.parent().parent().find('.td-status').html('已退款');
                    obj.remove();
                    layer.msg('退款成功', {icon: 1});
                  }else{
                    layer.msg('退款失败',{icon:5});
                  }
                }
             });
          }, function(){
            layer.msg('已取消',{icon:5});
          });
   })
//删除按钮事件
      $('.del').click(function(){
        var order_num = $('.order_num').text();
        var obj = $(this);
          layer.confirm('确定删除吗', {
          btn: ['确定','取消'] //按钮
          }, function(){
            $.ajax({
                type: "post",
                url:"deleteRefund",
                data: {order_num:order_num},
                dataType: "json",
                success: function(data) {
                  if (data==1) {
                    obj.parent().parent().remove();
                    layer.msg('删除成功', {icon: 1});
                  }else{
                    layer.msg('删除失败',{icon:5});
                  }
                }
              })
          }, function(){
            layer.msg('已取消',{icon:5});
          });
   })
  $('')
</script>


